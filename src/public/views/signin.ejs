<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="/css/signin.css">

  <title>KiAvenir - Inscription</title>
</head>
<body>
    <%- include('partials/header') %>

    <h1>Cr√©ation de compte</h1>

    <form name="accountCreation" action="/account/new" method="POST">
        <table>
            <tbody>
                <tr>
                    <td><label for="username">Entrez le nom d'utilisateur</label></td>
                    <td><input name="username" value="<%= locals.username ?? '' %>" /></td>
                    <td><label><%= locals.message ?? '' %></label></td>
                </tr>
                <tr>
                    <td><label for="password">Entrez le mot de passe</label></td>
                    <td><input type="password" name="password" value="" /></td>
                    <td><label id="passwordMessage"></label></td>
                </tr>
                <tr>
                    <td><label for="passwordRepeated">Confirmez le mot de passe</label></td>
                    <td><input type="password" id="passwordRepeated" value="" /></td>
                    <td><label id="passwordRepeatedMessage"></label></td>
                </tr>
            </tbody>
        </table>
        <div>
            <input type="submit" value="Cr√©er un compte"/>
        </div>
    </form>


    <script>
        // import { hashPassword, comparePassword } from '/js/hash.js';

        let FF_FOUC_FIX; /* pour emp√™cher un warning de chargement dans Firefox (FOUC) */

        const accountForm = document.forms.accountCreation;

        accountForm.addEventListener("submit", (e) => {
            e.preventDefault();
            validateAccountCreation();
        });

        async function validateAccountCreation() {
            // ...
            let username = document.querySelector('[name="username"]').value;
            let password = document.querySelector('[name="password"]').value;
            let passwordRepeated = document.querySelector('[id="passwordRepeated"]').value;
            
            //todo: √† supprimer
            console.log("username: '" + username + "'");
            console.log("password: '" + password + "'");
            console.log("passwordRepeated: '" + passwordRepeated + "'");


            if (password != passwordRepeated) {
                //todo: afficher une vraie erreur
                alert("Les mots de passe ne correspondent pas !");
            }

            // let hashedPassword = await hashPassword(password);
            // console.log("hashedPassword: '" + hashedPassword + "'");

            //todo: r√©cup√©rer le sel ??
            // let salt = "pas encore fait";

            //todo: enregistrer le compte dans la base de donn√©es
                // V√©rifier si doublons ou autre ? ü§î

        }
    </script>

    
    <%- include('partials/footer') %>
</body>

</html>
